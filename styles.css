// ============================================
// SAFE INITIALIZATION
// ============================================

const config = window.VALENTINE_CONFIG;

window.addEventListener('DOMContentLoaded', () => {
    validateConfig();
    applyThemeFromConfig();
    initializeTexts();
    createFloatingElements();
    setupLoveMeter();
    setupMusicPlayer();
});

// ============================================
// CONFIG VALIDATION
// ============================================

function validateConfig() {
    if (!config.valentineName) config.valentineName = "Babygirl";
}

function applyThemeFromConfig() {
    const root = document.documentElement;

    root.style.setProperty('--background-color-1', config.colors.backgroundStart);
    root.style.setProperty('--background-color-2', config.colors.backgroundEnd);
    root.style.setProperty('--button-color', config.colors.buttonBackground);
    root.style.setProperty('--button-hover', config.colors.buttonHover);
    root.style.setProperty('--text-color', config.colors.textColor);

    root.style.setProperty('--float-duration', config.animations.floatDuration);
    root.style.setProperty('--float-distance', config.animations.floatDistance);
    root.style.setProperty('--bounce-speed', config.animations.bounceSpeed);
    root.style.setProperty('--heart-explosion-size', config.animations.heartExplosionSize);
}

// ============================================
// TEXT INITIALIZATION
// ============================================

function initializeTexts() {
    document.title = config.pageTitle;

    document.getElementById('valentineTitle').textContent =
        `${config.valentineName}, babygirl ...`;

    // Question 1
    q('question1Text').textContent = config.questions.first.text;
    q('yesBtn1').textContent = config.questions.first.yesBtn;
    q('noBtn1').textContent = config.questions.first.noBtn;
    q('secretAnswerBtn').textContent = config.questions.first.secretAnswer;

    // Question 2
    q('question2Text').textContent = config.questions.second.text;
    q('startText').textContent = config.questions.second.startText;
    q('nextBtn').textContent = config.questions.second.nextBtn;

    // Question 3
    q('question3Text').textContent = config.questions.third.text;
    q('yesBtn3').textContent = config.questions.third.yesBtn;
    q('noBtn3').textContent = config.questions.third.noBtn;
}

function q(id) {
    return document.getElementById(id);
}

// ============================================
// FLOATING EMOJIS
// ============================================

function createFloatingElements() {
    const container = document.querySelector('.floating-elements');

    [...config.floatingEmojis.hearts, ...config.floatingEmojis.bears].forEach(e => {
        const div = document.createElement('div');
        div.className = e === 'ðŸ§¸' || e === 'ðŸ»' ? 'bear' : 'heart';
        div.innerHTML = e;
        div.style.left = Math.random() * 100 + 'vw';
        div.style.animationDelay = Math.random() * 5 + 's';
        container.appendChild(div);
    });
}

// ============================================
// BUTTON MOVEMENT
// ============================================

function moveButton(button) {
    const x = Math.random() * (window.innerWidth - button.offsetWidth);
    const y = Math.random() * (window.innerHeight - button.offsetHeight);
    button.style.position = 'fixed';
    button.style.left = x + 'px';
    button.style.top = y + 'px';
}

function showNextQuestion(n) {
    document.querySelectorAll('.question-section').forEach(q => q.classList.add('hidden'));
    q(`question${n}`).classList.remove('hidden');
}

// ============================================
// LOVE METER (FIXED)
// ============================================

function setupLoveMeter() {
    const loveMeter = q('loveMeter');
    const loveValue = q('loveValue');
    const extraLove = q('extraLove');

    loveMeter.value = 100;
    loveValue.textContent = 100;

    loveMeter.addEventListener('input', () => {
        const value = parseInt(loveMeter.value);
        loveValue.textContent = value;

        if (value <= 100) {
            extraLove.classList.add('hidden');
            return;
        }

        extraLove.classList.remove('hidden');

        if (value >= 6000) {
            extraLove.textContent = config.loveMessages.extreme;
        } else if (value >= 2500) {
            extraLove.textContent = config.loveMessages.mad;
        } else if (value >= 1000) {
            extraLove.textContent = config.loveMessages.high;
        } else {
            extraLove.textContent = config.loveMessages.normal;
        }
    });
}

// ============================================
// CELEBRATION
// ============================================

function celebrate() {
    document.querySelectorAll('.question-section').forEach(q => q.classList.add('hidden'));
    q('celebration').classList.remove('hidden');

    q('celebrationTitle').textContent = config.celebration.title;
    q('celebrationMessage').textContent = config.celebration.message;
    q('celebrationEmojis').textContent = config.celebration.emojis;
}

// ============================================
// MUSIC
// ============================================

function setupMusicPlayer() {
    const musicToggle = q('musicToggle');
    const bgMusic = q('bgMusic');
    const musicSource = q('musicSource');

    if (!config.music.enabled) {
        q('musicControls').style.display = 'none';
        return;
    }

    musicSource.src = config.music.musicUrl;
    bgMusic.volume = config.music.volume;
    bgMusic.load();

    musicToggle.addEventListener('click', () => {
        if (bgMusic.paused) {
            bgMusic.play();
            musicToggle.textContent = config.music.stopText;
        } else {
            bgMusic.pause();
            musicToggle.textContent = config.music.startText;
        }
    });
}
